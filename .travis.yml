language: rust
rust:
  - stable
  - beta
  - nightly
os:
  - osx
  - linux
env:
  - RUST_BACKTRACE=1
jobs:
  allow_failures:
    - rust: nightly
script:
  - cargo build --verbose
  - cargo test --verbose

# Need to cache the whole `.cargo` directory to keep .crates.toml for cargo-update to work
cache:
  directories:
    - /home/travis/.cargo

# But don't cache the cargo registry.
before_cache:
  - rm -rf /home/travis/.cargo/git
  - rm -rf /home/travis/.cargo/registry

matrix:
  fast_finish: true
  include:
    - name: Windows
      language: rust
      env:
        - RUST_BACKTRACE=1
        - TARGET=x86_64-pc-windows-msvc
      os: windows
      rust:
        - stable
        - beta
        - nightly
      before_script: rustup target add $TARGET
      script:
        - cargo build --release --target $TARGET
        - cargo test --verbose
      jobs:
        allow_failures:
          - rust: nightly

notifications:
  email:
    on_success: never
